<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlyFlex</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.css" integrity="sha512-jH/OMNSRhGuXAy3Wpsv+hlqYbB1QnZBrP13RtdZ+mU3jcTwDoa1kYsycfmc/2UE+exx2YgQ3xXx9BFgM53fJzw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    input { margin-bottom: 6px; }
  </style>
</head>
<body>
  <h1>Ricerca Volo</h1>

  <h2>Ricerca standard</h2>
  <form action="/search-flights" method="POST">
    <label>Da (aeroporto): <input name="from" required class="awesomplete" /></label><br />
    <label>A (aeroporto): <input name="to" required class="awesomplete" /></label><br />
    <label>Date (max 2, es. 2025-08-05,2025-08-12): <input name="dates" required /></label><br />
    <label>Ora Min (es. 06:00): <input type="time" name="time_min" required /></label><br />
    <label>Ora Max (es. 10:00): <input type="time" name="time_max" required /></label><br />
    <button type="submit">Cerca Voli</button>
  </form>

  <hr />

  <h2>Ricerca Avanzata da Pi√π Aeroporti con Fascia Oraria</h2>
  <form action="/multi-origin-advanced" method="POST" onsubmit="return validateLimits()">
    <label>Aeroporti (max 3, separati da virgola): <input id="airports" name="airports" required class="awesomplete" /></label><br />
    <label>Date (max 2, es. 2025-08-05,2025-08-12): <input id="dates" name="dates" required /></label><br />
    <label>Ora Min (es. 06:00): <input type="time" name="time_min" required /></label><br />
    <label>Ora Max (es. 10:00): <input type="time" name="time_max" required /></label><br />
    <button type="submit">Cerca Voli</button>
  </form>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/awesomplete/1.1.5/awesomplete.min.js" integrity="sha512-rqEnaxmHmbZZYIB3YgGi6SCF70YbRRU1V7vkhY57Fy08qjJg/YM0ohTeZ9L+XHzrW09DfMd7jI0D41F0+TljNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    fetch('/airports.json')
      .then(res => res.json())
      .then(data => {
        const airportList = data.map(a => `${a.code} - ${a.name}`);
        document.querySelectorAll(".awesomplete").forEach(input => {
          new Awesomplete(input, {
            list: airportList,
            minChars: 1,
            autoFirst: true,
            filter: Awesomplete.FILTER_CONTAINS
          });
        });
      });

    function validateLimits() {
      const airportCount = document.getElementById("airports").value.split(',').filter(a => a.trim()).length;
      const dateCount = document.getElementById("dates").value.split(',').filter(d => d.trim()).length;

      if (airportCount > 3) {
        alert("Puoi selezionare al massimo 3 aeroporti.");
        return false;
      }

      if (dateCount > 2) {
        alert("Puoi selezionare al massimo 2 date.");
        return false;
      }

      return true;
    }
  </script>
</body>
</html>
